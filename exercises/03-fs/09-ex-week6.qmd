---
title: "Administrant RAIDs"
lang: ca
---

## Instal¬∑laci√≥ d'un RAID1 a Alma Linux

### üß∞ Requisits previs

- Dos discs durs virtuals de 20 GB cadascun per la configuraci√≥ del RAID1.
- Imatge iso basada en Alma Linux.
- Un software de virtualitzaci√≥ com VirtualBox, VMware, UTM o QEMU.

### üéØ Objectiu
Configurar un **RAID1** per la partici√≥ `root (/)` durant la instal¬∑laci√≥ d‚ÄôAlma Linux.

### ü™õ Procediment d‚Äôinstal¬∑laci√≥

1. Inicieu la instal¬∑laci√≥ d‚ÄôAlma Linux fins a la pantalla de **selecci√≥ de discs**.  
2. Seleccioneu **els dos discs virtuals** i trieu l‚Äôopci√≥ **Personalitzat**.  
3. Feu clic a **Fet**.

    ![](../../figs/slides/03-raids/install_alma_raid1/seleccio_discs.png)

4. Apareixer√† la finestra de **particions manuals**:

    ![](../../figs/slides/03-raids/install_alma_raid1/particions_manuals.png)

5. Les particions creades seran:

   - `/boot/efi` ‚Äì 600 MB  
   - `/boot` ‚Äì 1 GB  
   - `swap` ‚Äì 2 GB  
   - `/` ‚Äì 16,4 GB  

6. Per configurar el RAID1, seleccioneu la partici√≥ `/` i feu clic a **Editar**.

    ![](../../figs/slides/03-raids/install_alma_raid1/raid1.png)

    - Trieu **RAID1** com a tipus de dispositiu.  
    - Feu clic a **Fet** ‚Üí **Acceptar canvis**.

### ‚úÖ Resultat final

![](../../figs/slides/03-raids/install_alma_raid1/resultat.png)

- Un cop finalitzada la instal¬∑laci√≥, el sistema es reiniciar√†.  
- Si tot √©s correcte, Alma Linux arrencar√† sense problemes.  
- Observeu que tenim dues particions `/` (una per disc).  

:::{.callout-warning title="Qu√® passa si el disc vda falla?"}
En cas de fallada del disc `vda`, el sistema **no arrencar√†** perqu√® la partici√≥ `/boot` no est√† replicada en RAID. Tenim replicada nom√©s la partici√≥ `/`. Per tant, si el disc `vda` falla, el sistema no podr√† accedir a la partici√≥ `/boot` i no podr√† arrencar.
:::

## Migraci√≥ de la carpeta `/home` a un RAID5

### üß∞ Requisits
En la m√†quina virtual anterior, podem afegir quatre discs durs virtuals de 1 GB cadascun (vdc, vdd, vde, vdf).

### üéØ Objectiu
Migrar el contingut de la carpeta `/home` a un dispositiu **RAID5** format per quatre discs virtuals.

### ü™õ Procediment

1. Creem el RAID5 amb la comanda seg√ºent:

    ```bash
    mdadm --create --verbose /dev/md0 --level=5 --raid-devices=4 /dev/vd[c-f]
    ```

2. Comprovem que el RAID s'ha creat correctament amb la comanda:

    ```bash
    cat /proc/mdstat
    ```

3. Creem un sistema de fitxers XFS en el dispositiu RAID5:

    ```bash
    mkfs.xfs /dev/md0
    ```

4. Muntarem el dispositiu RAID5 en un directori temporal:

    ```bash
    mkdir /mnt/raid
    mount /dev/md0 /mnt/raid
    ```

5. Copiem el contingut de la carpeta `/home` al dispositiu RAID5:

    ```bash
    cp -r /home/* /mnt/raid
    ```

6. Desmuntem el dispositiu RAID5 del directori temporal:

    ```bash
    umount /mnt/raid
    ```

7. Muntarem el dispositiu RAID5 en la carpeta `/home`:

    ```bash
    mount /dev/md0 /home
    ```

8. Per fer que el muntatge sigui permanent, afegim la seg√ºent l√≠nia al fitxer `/etc/fstab`:

    ```bash
    /dev/md0  /home  xfs  defaults  0 0
    ```

### ‚úÖ Resultat final

- El contingut de la carpeta `/home` s'ha migrat correctament al dispositiu RAID5.  
- El sistema utilitza ara el RAID5 per emmagatzemar les dades dels usuaris

## Simulaci√≥ de fallades en el RAID5

Ara simularem una fallada en un dels discs durs virtuals del RAID5. I observarem com el sistema continua funcionant sense problemes.

1. Crearem un usuari de prova i un fitxer de text a la seva carpeta `/home`:

    ```bash
    useradd test
    echo "Hola m√≥n" > /home/test/hola.txt
    chown -R test:test /home/test
    ```

2. Simulem la fallada d'un disc dur virtual del RAID5:

    ```bash
    mdadm --manage /dev/md0 --fail /dev/vdc
    ```

3. Comprovem que podem accedir al fitxer de text creat anteriorment:

    ```bash
    cat /home/test/hola.txt
    ```

4. Ara intentarem simular la fallada d'un segon disc dur virtual del RAID5:

    ```bash
    mdadm --manage /dev/md0 --fail /dev/vdd
    ```

5. Comprovem que el sistema ens avisa que no es pot fallar un segon disc perqu√® el RAID5 nom√©s tolera la fallada d'un disc:

    ```bash
    mdadm: Cannot remove /dev/vdd from /dev/md0,
           array will be failed.
    ```

## Exercicis

Es demana instal¬∑lar un sistema AlmaLinux de forma tradicional sense RAID en un disc virtual de 20‚ÄØGB (vda), creant les quatre particions habituals: `/boot/efi`, `/boot`, `swap` i `/`.

Un cop finalitzada la instal¬∑laci√≥:

- Afegiu dos discs durs virtuals addicionals de 20‚ÄØGB cadascun (**vdb i vdc**).
- Migrar les particions existents a RAID1 de la seg√ºent manera:
  - `/boot/efi` ‚Üí RAID1 amb **vdb1** i **vdc1**.
  - `/boot` ‚Üí RAID1 amb **vdb2** i **vdc2**.
  - `swap` ‚Üí RAID1 amb **vdb3** i **vdc3**.
  - `/` ‚Üí RAID1 amb **vdb4** i **vdc4**.
- Configureu el sistema perqu√® arranqui correctament des dels discs vdb i vdc.
- Un cop comprovat el correcte funcionament, elimineu el disc original vda.
- Verificar que el sistema arranca correctament despr√©s de la migraci√≥.
- Confirmar que totes les particions es troben en RAID1.
- Documentar tot el proc√©s amb captures de pantalla, explicacions detallades i justificacions t√®cniques en un informe final.