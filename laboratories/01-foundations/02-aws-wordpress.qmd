---
title: Deploying a web application
lang: en
---

**ARCHITECTURE**

![](/figs/laboratories/02-aws-wp/ArchitectureWordpress.png)

**CONTENTS:**

1. Creating a Data Base with RDS
2. Installing WordPress on the EC2 instance
3. Cleanup

## 1. Creating a Data Base (DB) with RDS

AWS' relational database service (RDS) is a very interesting option for deploying MySQL, MariaDB, PostgreSQL, Oracle, SQL Server, and Aurora databases. This service offers easy and efficient database management, as well as the ability to perform backups, scalability, and high availability.

1. Let's go to the dashboard of **Aurora and RDS**.

2. In the **Aurora and RDS** dashboard, click on **Create a database**

    * Choose a database creation method **Full configuration**
    * Select data base engine **MySQL**
    * Select the data base version **MySQL 8.0.43**
    * Select the template **Sandbox**
    * Select **Single-AZ DB instance deployment (1 instance)**
    * DB instance identifier **wordpress-db**
    * Master username **admin**
    * Credential management: **self-managed**
    * Set the password (**Lleida2030!!**). Type a password for the master and confirm it. Be sure to save this password—you’ll need it later.
    * Leave the rest of the parameters as default. Once finished, click **Create database**.


3. Wait a few minutes until the column **Status** turns green and says **Available**. The database creation process may take some time.


4. Once the database is available, click on the database and go to the tab **Connectivity & security** to view the connection details.

    * DB identifier: `wordpress-db`
    * Endpoint (similar to): `wordpress-db.cp66aquygfg3.us-east-1.rds.amazonaws.com`
    * Port: `3306`

    Save `Endpoint` (this is the `Hostname` of the DB). It will be used later.

5. To test the connection, we need a MySQL client. The easiest way is to create an EC2 instance and install the MySQL client.
     
    5.1. Create an EC2 instance with Amazon Linux 2023
    
    *  Go to the `EC2 dashboard`. You can do this by typing `EC2` into the search bar and clicking on the `EC2` service: 
    
     ![AWS Dashboard](/figs/laboratories/01-intro/searchbar.png)
     
     * Once you're on the **EC2 dashboard**,  you can import a Key pair  (**aws-keypair**) created previously. 
     
     * Next, click on **Instances** > **Launch Instances**, as shown below:
     
     ![EC2 Dashboard](/figs/laboratories/01-intro/ec2-1.png)
     
    *  Enter a (EC2) name: **AMSA**
     
    *  Leave everything as it is except Key pair name : If you have created a private key pair (as **aws-keypair** in the figure), select it, else select **vockey**. Then click **Launch instance**.
    
     ![EC2 Dashboard](/figs/laboratories/01-intro/ec2-2.png)
    
     We now have a running EC2 instance. This means we have a remote virtual machine on AWS that we can connect to from the **EC2 dashboard** or from our local computer using SSH (explained in ).
     
     Let’s see how to access from the EC2 dashboard.

 	5.2. Connect to the EC2 instance
	 
	 Go to the `EC2 dashboard`. 
	 Select the `EC2 instance` just created: **AMSA**
	 click on `Connect`, select `Connect using a Public IP`  and then click `Connect` again.
	 
	 You will access a terminal on the EC2 instance you created, logged in as `ec2-user`, as shown below::

	![](/figs/laboratories/02-aws-wp/Terminal-EC2.png)
	 
	Alternatively, you may access the EC2 instance through an SSH connection, as shown below: 
	 
	```bash
	cd   # we suppose the .ssh directory is located in the home of the user francesc
	ssh -i .ssh/aws-keypair ec2-user@<public-ip>
	```
	
	To get the **public-ip**,  Go to the EC2 dashboard and click `Instances`. Then click the AMSA EC2 instance. Copy the `public-ip`.
	
	 5.3. Install the MySQL client:

	 ```bash
	 # Search for the package to install
	 dnf search mysql
	 # Let’s install the MariaDB client
	 sudo dnf install mariadb105 -y
	 ```

6. Add a rule to the **Security Group** of the database to allow connections from the EC2 instance.

	6.1. Go to the dashboard of **Aurora and RDS**
	
	6.2. Click `Databases` and select our database instance (`wordpress-db`)
	
	6.3. In the section **Connectivity & security**, search for the **Security Group** associated with the database
	
	6.4. Click on the **default security group ** of type **EC2 Security Group - Inbound** to edit the rules (similar to *default sg-0efc4051ab6288a2d*). Click again in the same security group (*default sg-0efc4051ab6288a2d*) and then in **Inboud rules**, click on **Edit Inboud rules**:

    ![](/figs/laboratories/02-aws-wp/DB-SecurityGroup-Inbound.png)
	
	6.5. Click  `Delete` the existing **Inboud rule**
	
	6.6. Add a new inbound rule to allow connections from the IP address of our EC2 instance. Click `Add rule`. Select the  **type** `MySQL/Aurora`, **Source type**  `Custom` and **Source** the default security group of the EC2 instance (similar to **launch-wizard-1**) to allow it to connect to the DB, like this:

     ```plaintext
     Type: MySQL/Aurora
     Protocol: TCP
     Port Range: 3306
     Source: Custom
     Select the security group of the EC2 instance (launch-wizard-1)
     ```

    Click `Save rules`

 7. Connect to the RDS database from the `EC2 terminal`:

    ```bash
    mysql -h hostname -u admin -p
    # Enter the admin password (created earlier) when prompted
    ```
   `hostname` is the database (**Endpoint**) saved earlier (`wordpress-db.cp66aquygfg3.us-east-1.rds.amazonaws.com`) and
   `admin` is the master user created earlier, along with its password. This is:
   
     ```bash
    mysql -h wordpress-db.cp66aquygfg3.us-east-1.rds.amazonaws.com -u admin -p
    Enter password: Lleida2030!!
    ```

8. When entering MySQL, at the MySQL promtp (**MySQL [(none)]>  **), create the database **wordpressdb**, user **wordpressuser** and password **wordpresspasswd**, with all permissions:

    ```sql
    CREATE DATABASE wordpressdb;
    CREATE USER 'wordpressuser'@'%' IDENTIFIED BY 'wordpresspasswd';
    GRANT ALL PRIVILEGES ON wordpressdb.* TO 'wordpressuser'@'%';
    FLUSH PRIVILEGES;
    exit
    ```
    
9. We already have the database ready for the WordPress installation

## 2.  Installing WordPress on the EC2 instance

1. To install WordPress, a web server (**Apache**) must be installed first  in the **EC2 instance**:

    ```bash
    sudo dnf install httpd -y
    sudo systemctl start httpd
    sudo systemctl enable httpd
    ```

::: {.callout-tip title="Note"}
Note that the start command *start* the Apache service, but it does not make it start automatically when the machine is rebooted. Therefore, we also need to run the *enable* command
:::

2. By default, the security group of the EC2 instance does not allow HTTP connections (port 80). You can verify this by trying to access the public IP address of the EC2 instance from a web browser. Enter EC2, click `Instances`, choose the instance `wordpress`, copy the `Public IPv4 address` (i.e. 44.200.65.68). Insert `http://44.200.65.68` in a browser. You will see that it cannot connect.

::: {.callout-tip title="Note"}
If you click the link to the public IP address, it will try to access via HTTPS, but since we don't have an SSL certificate, it won't work. Manually modify the URL to http://<public_ip_addres>
:::
   
3. We need to add an inbound rule to the security group to allow HTTP connections:

    - Go to the **EC2** dashboard
    - Select our EC2 instance
    - In the section of **Security**, click on the **Security Group** associated with the instance (`sg-038f49ebd3fbe8b5a (launch-wizard-1)`).
    - Add a new inbound rule to allow HTTP connections. 
    	- Click `Edit Inbound rules`.  Click `Add rule`. Insert the following:

			```plaintext
			Type: HTTP
			Protocol: TCP
			Port Range: 80
			Source: Anywhere-IPv4 (0.0.0.0/0)
			```
    	- Click `Save rules`

::: {.callout-tip title="Note"}
This rule will allow HTTP connections from anywhere
:::
	

4. Once the rule has been added, we can access the public IP address of the EC2 instance from the web browser and verify it: 

	Insert `http://44.200.65.68` in a browser. It will appear in the screen: 
	 **It works!**


5. A requirement for WordPress is to have PHP installed. Let's install PHP and the necessary extensions in the **EC2 instance**:

    ```bash
    sudo dnf install php8.1 -y
    sudo dnf install php-curl php-zip php-gd php-soap php-intl php-mysqlnd php-pdo -y
    ```

6. Restart the Apache service to load the PHP extensions:

    ```bash
    sudo systemctl restart httpd
    ```

7. Now we can install WordPress. First, we download the latest version of WordPress and save it to Apache's default directory:

    ```bash
    cd /tmp
    wget https://wordpress.org/latest.tar.gz
    tar -xvzf latest.tar.gz
    sudo mv wordpress/* /var/www/html/
    sudo rm -rf wordpress latest.tar.gz
    sudo chown -R apache:apache /var/www/html/
    ```

8. Access the public IP address of the EC2 instance from your web browser (`http://44.200.65.68`). You should see the WordPress installation page

9. Follow the steps of the WordPress installation:

    - Select the language (*English*)
    - Click on **Continue**
    - Click on **Let's go**
    - Enter the database connection details:
      - Database Name: `wordpressdb`
      - Username: `wordpressuser` (previously created user)
      - Password: `wordpresspasswd` (password created earlier)
      - Database Host: the RDS database endpoint (for example: `wordpress-db.cp66aquygfg3.us-east-1.rds.amazonaws.com`)
      - Table Prefix: `wp_` (default)
    - Click on **Send**
    - If everything is correct, click on **Run the installation**
    - Enter the site title (**AMSA AWS-Lab**), el nom d'usuari (**francesc**), the password (**9T3nEBqnFqDW3uhc7S**) and the email (**francesc.solsona@udl.cat**)
    - Click on **Install WordPress**
    - Once the installation is complete, click on **Inicia sessió** and enter the credentials you created
    - You will enter in the WordPress administration web (`http://44.200.65.68/wp-admin`). 

## 3. Cleanup

Once completed, you can delete all EC2 instances and the RDS database to avoid unnecessary charges to your AWS account.

