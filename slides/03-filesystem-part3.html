<!DOCTYPE html>
<html lang="en"><head>
<script src="../site_libs/clipboard/clipboard.min.js"></script>
<script src="../site_libs/quarto-html/tabby.min.js"></script>
<script src="../site_libs/quarto-html/popper.min.js"></script>
<script src="../site_libs/quarto-html/tippy.umd.min.js"></script>
<link href="../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../site_libs/quarto-html/light-border.css" rel="stylesheet">
<link href="../site_libs/quarto-html/quarto-syntax-highlighting-7b89279ff1a6dce999919e0e67d4d9ec.css" rel="stylesheet" id="quarto-text-highlighting-styles"><meta charset="utf-8">
  <meta name="generator" content="quarto-1.8.25">

  <meta name="author" content="Jordi Mateo Fornés">
  <title>AMSA - Fall 2025 – Sistema de fitxers (III)</title>
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, minimal-ui">
  <link rel="stylesheet" href="../site_libs/revealjs/dist/reset.css">
  <link rel="stylesheet" href="../site_libs/revealjs/dist/reveal.css">
  <style>
    code{white-space: pre-wrap;}
    span.smallcaps{font-variant: small-caps;}
    div.columns{display: flex; gap: min(4vw, 1.5em);}
    div.column{flex: auto; overflow-x: auto;}
    div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
    ul.task-list{list-style: none;}
    ul.task-list li input[type="checkbox"] {
      width: 0.8em;
      margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
      vertical-align: middle;
    }
    /* CSS for syntax highlighting */
    html { -webkit-text-size-adjust: 100%; }
    pre > code.sourceCode { white-space: pre; position: relative; }
    pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
    pre > code.sourceCode > span:empty { height: 1.2em; }
    .sourceCode { overflow: visible; }
    code.sourceCode > span { color: inherit; text-decoration: inherit; }
    div.sourceCode { margin: 1em 0; }
    pre.sourceCode { margin: 0; }
    @media screen {
    div.sourceCode { overflow: auto; }
    }
    @media print {
    pre > code.sourceCode { white-space: pre-wrap; }
    pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
    }
    pre.numberSource code
      { counter-reset: source-line 0; }
    pre.numberSource code > span
      { position: relative; left: -4em; counter-increment: source-line; }
    pre.numberSource code > span > a:first-child::before
      { content: counter(source-line);
        position: relative; left: -1em; text-align: right; vertical-align: baseline;
        border: none; display: inline-block;
        -webkit-touch-callout: none; -webkit-user-select: none;
        -khtml-user-select: none; -moz-user-select: none;
        -ms-user-select: none; user-select: none;
        padding: 0 4px; width: 4em;
        color: #aaaaaa;
      }
    pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
    div.sourceCode
      { color: #003b4f; background-color: #f1f3f5; }
    @media screen {
    pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
    }
    code span { color: #003b4f; } /* Normal */
    code span.al { color: #ad0000; } /* Alert */
    code span.an { color: #5e5e5e; } /* Annotation */
    code span.at { color: #657422; } /* Attribute */
    code span.bn { color: #ad0000; } /* BaseN */
    code span.bu { } /* BuiltIn */
    code span.cf { color: #003b4f; font-weight: bold; } /* ControlFlow */
    code span.ch { color: #20794d; } /* Char */
    code span.cn { color: #8f5902; } /* Constant */
    code span.co { color: #5e5e5e; } /* Comment */
    code span.cv { color: #5e5e5e; font-style: italic; } /* CommentVar */
    code span.do { color: #5e5e5e; font-style: italic; } /* Documentation */
    code span.dt { color: #ad0000; } /* DataType */
    code span.dv { color: #ad0000; } /* DecVal */
    code span.er { color: #ad0000; } /* Error */
    code span.ex { } /* Extension */
    code span.fl { color: #ad0000; } /* Float */
    code span.fu { color: #4758ab; } /* Function */
    code span.im { color: #00769e; } /* Import */
    code span.in { color: #5e5e5e; } /* Information */
    code span.kw { color: #003b4f; font-weight: bold; } /* Keyword */
    code span.op { color: #5e5e5e; } /* Operator */
    code span.ot { color: #003b4f; } /* Other */
    code span.pp { color: #ad0000; } /* Preprocessor */
    code span.sc { color: #5e5e5e; } /* SpecialChar */
    code span.ss { color: #20794d; } /* SpecialString */
    code span.st { color: #20794d; } /* String */
    code span.va { color: #111111; } /* Variable */
    code span.vs { color: #20794d; } /* VerbatimString */
    code span.wa { color: #5e5e5e; font-style: italic; } /* Warning */
  </style>
  <link rel="stylesheet" href="../site_libs/revealjs/dist/theme/quarto-534cd8e3a96973385dffff3f4709048d.css">
  <link rel="stylesheet" href="styles.css">
  <link href="../site_libs/revealjs/plugin/quarto-line-highlight/line-highlight.css" rel="stylesheet">
  <link href="../site_libs/revealjs/plugin/reveal-menu/menu.css" rel="stylesheet">
  <link href="../site_libs/revealjs/plugin/reveal-menu/quarto-menu.css" rel="stylesheet">
  <link href="../site_libs/revealjs/plugin/quarto-support/footer.css" rel="stylesheet">
  <style type="text/css">
    .reveal div.sourceCode {
      margin: 0;
      overflow: auto;
    }
    .reveal div.hanging-indent {
      margin-left: 1em;
      text-indent: -1em;
    }
    .reveal .slide:not(.center) {
      height: 100%;
    }
    .reveal .slide.scrollable {
      overflow-y: auto;
    }
    .reveal .footnotes {
      height: 100%;
      overflow-y: auto;
    }
    .reveal .slide .absolute {
      position: absolute;
      display: block;
    }
    .reveal .footnotes ol {
      counter-reset: ol;
      list-style-type: none; 
      margin-left: 0;
    }
    .reveal .footnotes ol li:before {
      counter-increment: ol;
      content: counter(ol) ". "; 
    }
    .reveal .footnotes ol li > p:first-child {
      display: inline-block;
    }
    .reveal .slide ul,
    .reveal .slide ol {
      margin-bottom: 0.5em;
    }
    .reveal .slide ul li,
    .reveal .slide ol li {
      margin-top: 0.4em;
      margin-bottom: 0.2em;
    }
    .reveal .slide ul[role="tablist"] li {
      margin-bottom: 0;
    }
    .reveal .slide ul li > *:first-child,
    .reveal .slide ol li > *:first-child {
      margin-block-start: 0;
    }
    .reveal .slide ul li > *:last-child,
    .reveal .slide ol li > *:last-child {
      margin-block-end: 0;
    }
    .reveal .slide .columns:nth-child(3) {
      margin-block-start: 0.8em;
    }
    .reveal blockquote {
      box-shadow: none;
    }
    .reveal .tippy-content>* {
      margin-top: 0.2em;
      margin-bottom: 0.7em;
    }
    .reveal .tippy-content>*:last-child {
      margin-bottom: 0.2em;
    }
    .reveal .slide > img.stretch.quarto-figure-center,
    .reveal .slide > img.r-stretch.quarto-figure-center {
      display: block;
      margin-left: auto;
      margin-right: auto; 
    }
    .reveal .slide > img.stretch.quarto-figure-left,
    .reveal .slide > img.r-stretch.quarto-figure-left  {
      display: block;
      margin-left: 0;
      margin-right: auto; 
    }
    .reveal .slide > img.stretch.quarto-figure-right,
    .reveal .slide > img.r-stretch.quarto-figure-right  {
      display: block;
      margin-left: auto;
      margin-right: 0; 
    }
  </style>
</head>
<body class="quarto-light">
  <div class="reveal">
    <div class="slides">

<section id="title-slide" class="quarto-title-block center">
  <h1 class="title">Sistema de fitxers (III)</h1>
  <p class="subtitle">Unitat 3 · Administració i Manteniment de Sistemes i Aplicacions (AMSA)</p>

<div class="quarto-title-authors">
<div class="quarto-title-author">
<div class="quarto-title-author-name">
Jordi Mateo Fornés 
</div>
</div>
</div>

</section>
<section>
<section id="introducció-a-lvm" class="title-slide slide level1 center">
<h1>Introducció a LVM</h1>

</section>
<section id="contextutalització" class="slide level2 smaller">
<h2>Contextutalització</h2>
<p>Imaginem que disposem d’un servidor amb un únic disc dur, dividit en quatre particions. Aquestes particions són:</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb1"><pre class="sourceCode numberSource bash number-lines code-with-copy"><code class="sourceCode bash"><span id="cb1-1"><a></a><span class="ex">Filesystem</span>      Size  Used   Avail  Use%   Mounted on</span>
<span id="cb1-2"><a></a><span class="ex">/dev/sda1</span>       20G   5.5G   14G    29%    /</span>
<span id="cb1-3"><a></a><span class="ex">/dev/sda2</span>       10G   10G    0G     100%   /home</span>
<span id="cb1-4"><a></a><span class="ex">/dev/sda3</span>       5G    1G     4G     20%    /var</span>
<span id="cb1-5"><a></a><span class="ex">/dev/sda4</span>       5G    1G     4G     20%    /tmp</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="fragment">
<p>Què passa si la partició <code>/home</code> s’omple i la resta de particions tenen espai lliure?</p>
</div>
<div class="fragment">
<p>La solució tradicional seria redimensionar les particions per alliberar espai per a <code>/home</code>.</p>
</div>
<div class="fragment">
<p>➡️ Això implica complexitat i possibilitat d’errors.</p>
</div>
<div class="fragment">
<p>Per tant, necessitem una solució més <strong>flexible</strong> que ens permeti redimensionar les particions sense haver de moure dades i en temps real.</p>
</div>
<aside class="notes">
<p>Una situació típica quan administrem servidors és que una partició s’ompli i la resta de particions tinguin espai lliure. En aquest cas, la partició <code>/home</code> s’ha omplert i la resta de particions tenen espai lliure. Per solucionar aquest problema, hauríem de redimensionar les particions per alliberar espai per a <code>/home</code>. Això implica complexitat i possibilitat d’errors. Per tant, necessitem una solució més flexible. Que ens permeti redimensionar les particions sense haver de moure dades i en temps real.</p>
<style type="text/css">
        span.MJX_Assistive_MathML {
          position:absolute!important;
          clip: rect(1px, 1px, 1px, 1px);
          padding: 1px 0 0 0!important;
          border: 0!important;
          height: 1px!important;
          width: 1px!important;
          overflow: hidden!important;
          display:block!important;
      }</style></aside>
</section>
<section id="introducció-a-lvm-1" class="slide level2 smaller">
<h2>Introducció a LVM</h2>
<p><strong>Logical Volume Manager (LVM)</strong> és un sistema de gestió de discos que permet als administradors <em>gestionar l’espai de disc de manera més flexible</em> que amb les particions tradicionals, resolent problemes comuns.</p>
<div class="fragment">
<p>En la situació anterior, LVM ens permetria en temps real i sense aturar el sistema:</p>
<ul>
<li class="fragment"><strong>Redimensionar</strong> les particions <code>/var</code> i <code>/tmp</code> per <em>alliberar espai</em> per a <code>/home</code>.</li>
<li class="fragment"><strong>Redimensionar</strong> la partició <code>/home</code> a partir de l’espai alliberat.</li>
</ul>
</div>
<div class="fragment">
<p>o bé també ens permetria:</p>
<ul>
<li class="fragment"><strong>Afegir</strong> un nou disc dur físic al servidor.</li>
<li class="fragment"><strong>Utilitzar</strong> aquest disc dur per a <strong>augmentar l’espai</strong> de la partició <code>/home</code>.</li>
</ul>
</div>
<div class="fragment center-container">
<p><strong>Crear</strong>, <strong>eliminar</strong>, <strong>redimensionar</strong> i <strong>moure</strong> particions en temps real.</p>
</div>
</section>
<section id="característiques-de-lvm" class="slide level2 smaller">
<h2>Característiques de LVM</h2>
<ul>
<li class="fragment"><p><strong>Aprovisionament</strong>: Permet <em>combinar la capacitat</em> de diferents dispositius físics per crear un únic o múltiples volums vírtuals. <span class="fragment">Per exemple, es poden combinar quatre discs durs de 1TB per crear un únic volum virtual de 4TB.</span></p></li>
<li class="fragment"><p><strong>Elasticitat</strong>: Permet <em>augmentar o disminuir</em> l’espai assignat a un volum virtual, sense necessitat de reiniciar el sistema. <span class="fragment">Per exemple, si un volum virtual s’està quedant sense espai, es pot augmentar la seva mida o reduir-la.</span></p></li>
<li class="fragment"><p><strong>Escalabilitat</strong>: Permet <em>afegir o eliminar</em> dispositius físics al grup de volums per augmentar o disminuir l’espai d’emmagatzematge segons les necessitats. <span class="fragment">Per exemple, si es necessita més espai d’emmagatzematge, es poden afegir nous discs físics.</span></p></li>
<li class="fragment"><p><strong>Resiliència</strong>: Atorga la capacitat de crear còpies de seguretat de les dades per protegir-les davant possibles errors o danys. <span class="fragment">Per exemple, es poden crear snapshots o miralls (mirroring).</span></p></li>
</ul>
</section>
<section id="components-de-lvm" class="slide level2 smaller">
<h2>Components de LVM</h2>
<div class="columns">
<div class="column" style="width:45%;">
<ul>
<li class="fragment"><p><strong>PV (Physical Volume)</strong>: Dispositiu físic que es pot utilitzar per emmagatzemar dades. Per exemple, un disc dur, una partició, un dispositiu RAID, etc.</p></li>
<li class="fragment"><p><strong>LV (Logical Volume)</strong>: Bloc de dades que es pot utilitzar per emmagatzemar dades i contenir el seu propi sistema de fitxers. Equivalent a una partició de disc en un sistema sense LVM.</p></li>
<li class="fragment"><p><strong>VG (Volume Group)</strong>: Agrupació de LVs i PVs en una unitat administrativa. Un VG pot contenir diversos PVs i LVs.</p></li>
</ul>
</div><div class="column" style="width:55%;">
<p><img data-src="../figs/slides/03-lvm/anatomia.png"></p>
</div></div>
</section>
<section id="mapeig-i-extensions" class="slide level2 smaller">
<h2>Mapeig i Extensions</h2>
<div class="columns">
<div class="column" style="width:55%;">
<h4 id="pe-physical-extent">PE (Physical Extent)</h4>
<p>És la unitat mínima d’emmagatzematge que es pot assignar a un PV. <span class="fragment">Normalment, un PE té una mida de 4MB.</span></p>
<h4 id="le-logical-extent">LE (Logical Extent)</h4>
<p>És la unitat mínima d’emmagatzematge que es pot assignar a un LV. <span class="fragment">Per exemple, si un LE té una mida de 4MB, un LV de 1GB tindrà 256 LE.</span></p>
<h4 id="observacions">Observacions</h4>
<ul>
<li class="fragment">Cada VG s’encarrega de gestionar l’emmagatzematge físic (physical extents) mappejant-lo en emmagatzematge lògic (logical extents).</li>
<li class="fragment">Els PE i LE tenen la mateixa mida però són diferents en funció de l’estrategia de mapeig.</li>
</ul>
</div><div class="column" style="width:35%;">
<p><img data-src="../figs/slides/03-lvm/mapping1.png"></p>
</div></div>
</section>
<section id="estratègies-de-mapeig" class="slide level2 smaller">
<h2>Estratègies de Mapeig</h2>
<div class="columns">
<div class="column" style="width:50%;">
<p><img data-src="../figs/slides/03-lvm/lineal.png"></p>
</div><div class="column" style="width:50%;">
<p><img data-src="../figs/slides/03-lvm/striped.png"></p>
</div></div>
</section>
<section id="exemple-i-consideracions" class="slide level2 smaller">
<h2>Exemple i Consideracions</h2>
<div class="columns">
<div class="column" style="width:60%;">
<p><img data-src="../figs/slides/03-lvm/mapping3.png"></p>
</div><div class="column" style="width:30%;">
<ul>
<li class="fragment"><p>Es poden utilitzar dispositius de diferents mides i velocitats.</p></li>
<li class="fragment"><p>Un PV només pot pertànyer a un VG.</p></li>
<li class="fragment"><p>Un LV només pot pertànyer a un VG.</p></li>
<li class="fragment"><p>Un VG pot contenir diversos PVs i LVs.</p></li>
<li class="fragment"><p>Les funcions de mirror i snapshot requereixen més d’un PV.</p></li>
</ul>
</div></div>
</section>
<section id="snapshots" class="slide level2 smaller">
<h2>Snapshots</h2>
<p>Els <strong>snapshots</strong> són còpies instantànies d’un LV en un moment concret. El seu funcionament és <strong>incremental</strong>: només es copien les dades que han canviat des de l’últim snapshot.</p>
<h4 id="per-què-són-útils">Per què són útils?</h4>
<ul>
<li class="fragment"><strong>Còpies de seguretat</strong>: Realitzar còpies de seguretat de les dades sense aturar el sistema.</li>
<li class="fragment"><strong>Restauració</strong>: Restaurar les dades a un estat anterior.</li>
<li class="fragment"><strong>Tests</strong>: Provar canvis en el sistema sense afectar les dades originals.</li>
</ul>
<h4 id="compte">Compte!</h4>
<p>Les <strong>instantànies ocupen espai en el VG</strong>. Per tant, si es crea una instantània i després es sobreescriu completament el LV original, l’instantània hauria de ser almenys tan gran com el LV original per poder emmagatzemar tots els canvis.</p>
</section></section>
<section>
<section id="lvm-a-linux" class="title-slide slide level1 center">
<h1>LVM a Linux</h1>

</section>
<section id="paquet-lvm2" class="slide level2 smaller">
<h2>Paquet <code>lvm2</code></h2>
<p>En la majoria de les distribucions de Linux, el paquet <code>lvm2</code> permet la creació i gestió de dispositius LVM.</p>
<div class="columns">
<div class="column" style="width:50%;">
<h4 id="distribucions-basades-en-red-hat">Distribucions basades en Red Hat</h4>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb2"><pre class="sourceCode numberSource bash number-lines code-with-copy"><code class="sourceCode bash"><span id="cb2-1"><a></a><span class="ex">dnf</span> search lvm2</span>
<span id="cb2-2"><a></a><span class="ex">dnf</span> install lvm2 <span class="at">-y</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div><div class="column" style="width:50%;">
<h4 id="distribucions-basades-en-debian">Distribucions basades en Debian</h4>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb3"><pre class="sourceCode numberSource bash number-lines code-with-copy"><code class="sourceCode bash"><span id="cb3-1"><a></a><span class="ex">apt</span> search lvm2</span>
<span id="cb3-2"><a></a><span class="ex">apt</span> install lvm2 <span class="at">-y</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div></div>
<div class="center-container">
<p>El funcionament del paquet <code>lvm2</code> és similar en totes les distribucions de Linux. Per tant, les instruccions d’ús són similars i no importa la distribució que s’utilitzeu.</p>
</div>
</section>
<section id="creació-de-pvs" class="slide level2 smaller">
<h2>Creació de PVs</h2>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb4"><pre class="sourceCode numberSource bash number-lines code-with-copy"><code class="sourceCode bash"><span id="cb4-1"><a></a><span class="ex">pvcreate</span> PV <span class="pp">[</span><span class="ss">opcions</span><span class="pp">]</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p>On: PV pot ser un disc dur, una partició, un dispositiu RAID, etc.</p>
<ul>
<li class="fragment"><strong>–dataalignment mida[Unitat]</strong>: Alinia el començament del PV.</li>
<li class="fragment"><strong>–dataalignmentoffset mida[Unitat]</strong>: Offset per modificar alineació de dades.</li>
<li class="fragment"><strong>–labelsector sector</strong>: Per defecte, el PV està etiquetat amb un identificador LVM2 al seu segon sector (sector 1). Això us permet utilitzar un sector diferent a prop de l’inici del disc (entre 0 i 3).</li>
<li class="fragment"><strong>–metadatasize mida[Unitat]</strong>: Mida de les metadades.</li>
<li class="fragment"><strong>–setphysicalvolumesize mida[Unitat]</strong>: Mida dels PE.</li>
<li class="fragment"><strong>–longhelp</strong>: Mostra totes les opcions (semblant a <code>man pvcreate</code>).</li>
<li class="fragment"><strong>–uuid uuid</strong>: Assigna un UUID al PV.</li>
</ul>
<div class="center">
<p><strong>Ús tradicional</strong>: <code>pvcreate /dev/sdb</code> sense opcions.</p>
</div>
</section>
<section id="organització-interna-dels-pvs" class="slide level2 smaller">
<h2>Organització interna dels PVs</h2>
<div class="center-container">
<p><img data-src="../figs/slides/03-lvm/PV-org-int.png"></p>
</div>
</section>
<section id="exemples-de-lús-de-pvcreate" class="slide level2 smaller">
<h2>Exemples de l’ús de <code>pvcreate</code></h2>
<ul>
<li class="fragment">Inicialització a partir d’un disc dur amb alineació de dades de 1MB començant des del sector 7.</li>
</ul>
<div class="fragment">
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb5"><pre class="sourceCode numberSource bash number-lines code-with-copy"><code class="sourceCode bash"><span id="cb5-1"><a></a><span class="ex">pvcreate</span> <span class="at">--dataalignment</span> 1M <span class="at">--dataalignmentoffset</span> 7s /dev/sdb</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
<ul>
<li class="fragment">Inicialització a partir d’una partició amb un UUID específic.</li>
</ul>
<div class="fragment">
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb6"><pre class="sourceCode numberSource bash number-lines code-with-copy"><code class="sourceCode bash"><span id="cb6-1"><a></a><span class="ex">pvcreate</span> <span class="at">--uuid</span> <span class="st">"my-pv-uuid"</span> /dev/sdb1</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
<ul>
<li class="fragment">Inicialització a partir d’un raid amb mida de metadades 128MB i 8MB per PE (enlloc de 4MB).</li>
</ul>
<div class="fragment">
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb7"><pre class="sourceCode numberSource bash number-lines code-with-copy"><code class="sourceCode bash"><span id="cb7-1"><a></a><span class="ex">pvcreate</span> <span class="at">--setphysicalvolumesize</span> 8M <span class="at">--metadatasize</span> 128M /dev/md0</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
</section>
<section id="modificar-pvs-amb-pvchange" class="slide level2 smaller">
<h2>Modificar PVs amb <code>pvchange</code></h2>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb8"><pre class="sourceCode numberSource bash number-lines code-with-copy"><code class="sourceCode bash"><span id="cb8-1"><a></a><span class="ex">pvchange</span> <span class="pp">[</span><span class="ss">opcions</span><span class="pp">]</span> PV</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<ul>
<li class="fragment"><strong>–all</strong>: Aplica l’acció a tots els PVs (no cal especificar el PV).</li>
<li class="fragment"><strong>–addtag tag</strong>: Afegeix una etiqueta al PV.</li>
<li class="fragment"><strong>–deltag tag</strong>: Elimina una etiqueta del PV.</li>
<li class="fragment"><strong>–longhelp</strong>: Mostra totes les opcions (semblant a <code>man pvcreate</code>).</li>
<li class="fragment"><strong>–uuid uuid</strong>: Assigna un UUID al PV.</li>
<li class="fragment"><strong>–allocatable y/n</strong>: Activa o desactiva l’assignació de PE al PV.</li>
<li class="fragment"><strong>–autobackup y/n</strong>: Activa o desactiva la còpia de seguretat automàtica de les metadades.</li>
</ul>
</section>
<section id="redimensionar-pvs-amb-pvresize" class="slide level2 smaller">
<h2>Redimensionar PVs amb <code>pvresize</code></h2>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb9"><pre class="sourceCode numberSource bash number-lines code-with-copy"><code class="sourceCode bash"><span id="cb9-1"><a></a><span class="ex">pvresize</span> <span class="pp">[</span><span class="ss">opcions</span><span class="pp">]</span> PV</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<ul>
<li class="fragment"><strong>–setphysicalvolumesize mida[Unitat]</strong>: Redimensiona el PV.</li>
<li class="fragment"><strong>–longhelp</strong>: Mostra totes les opcions (semblant a <code>man pvresize</code>).</li>
</ul>
<div class="fragment">
<h4 id="consideracions-pràctiques">Consideracions pràctiques</h4>
<ol type="1">
<li class="fragment"><p><code>pvresize</code> redimensiona el PV, però no redimensiona les particions o els sistemes de fitxers que conté. Hauràs de fer això manualment si és necessari.</p></li>
<li class="fragment"><p><code>pvresize</code> refusarà reduir un PV si té extensiones assignades més enllà del nou final. Hauràs de moure o eliminar aquestes extensions primer.</p></li>
<li class="fragment"><p><code>pvresize</code> permet redimensionar un PV encara que estigui inclòs en un VG amb LVs actius.</p></li>
</ol>
</div>
</section>
<section id="exemples-pvresize" class="slide level2 smaller">
<h2>Exemples <code>pvresize</code></h2>
<ul>
<li class="fragment">Expandir un PV després d’ampliar la partició per utilitzar tot el nou espai disponible.</li>
</ul>
<div class="fragment">
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb10"><pre class="sourceCode numberSource bash number-lines code-with-copy"><code class="sourceCode bash"><span id="cb10-1"><a></a><span class="ex">pvresize</span> /dev/sdb1</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
<ul>
<li class="fragment">Reduir un PV abans de reduir la partició (assegurar-se que la mida del PV és adequada per a la nova mida de la partició).</li>
</ul>
<div class="fragment">
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb11"><pre class="sourceCode numberSource bash number-lines code-with-copy"><code class="sourceCode bash"><span id="cb11-1"><a></a><span class="ex">pvresize</span> <span class="at">--setphysicalvolumesize</span> 40G /dev/sdb1</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
</section>
<section id="eliminar-pvs-amb-pvremove" class="slide level2 smaller">
<h2>Eliminar PVs amb <code>pvremove</code></h2>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb12"><pre class="sourceCode numberSource bash number-lines code-with-copy"><code class="sourceCode bash"><span id="cb12-1"><a></a><span class="ex">pvremove</span> PV</span>
<span id="cb12-2"><a></a><span class="co"># Podeu obtenir la llista d'opcions amb pvremove --longhelp </span></span>
<span id="cb12-3"><a></a><span class="co"># o bé pvremove --help</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<ul>
<li class="fragment"><code>pvremove</code> elimina totes les metadades del PV, però no elimina les dades.</li>
<li class="fragment"><code>pvremove</code> no permet eliminar PVs que estiguin en ús. Hauràs de moure o eliminar les extensions primer.</li>
<li class="fragment"><code>pvremove</code> no permet eliminar PVs que formin part d’un VG. Hauràs de treure el PV del VG primer.</li>
</ul>
<div class="center-container fragment">
<p>Per eliminar les dades del PV, hauràs de sobreescriure el PV amb zeros <code>dd if=/dev/zero of=PV bs=1M count=1</code> o bé formatejar el dispositiu.</p>
</div>
</section>
<section id="obtenir-informació-pvs" class="slide level2 smaller">
<h2>Obtenir informació <code>pvs</code></h2>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb13"><pre class="sourceCode numberSource bash number-lines code-with-copy"><code class="sourceCode bash"><span id="cb13-1"><a></a><span class="ex">pvs</span> <span class="pp">[</span><span class="ss">opcions</span><span class="pp">]</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<ul>
<li class="fragment"><strong>–allpvs</strong>: Mostra tots els PVs, inclosos els PVs inactius.</li>
<li class="fragment"><strong>–all</strong>: Mostra tots els dispositius que no han estat inicialitzats com a PVs.</li>
<li class="fragment"><strong>–noheadings</strong>: No mostra la capçalera (bona combinació amb <code>grep</code>).</li>
<li class="fragment"><strong>–devices PV</strong>: Restringeix la sortida als PVs especificats.</li>
<li class="fragment"><strong>–options String</strong>: Permet seleccionar les columnes a mostrar. Per a més informació, consulteu <code>pvs -o help</code>.</li>
<li class="fragment"><strong>–longhelp</strong>: Mostra totes les opcions (semblant a <code>man pvs</code>).</li>
</ul>
<div class="fragment">
<p>Altres opcions per a visualitzar información són: <code>pvdisplay</code> i <code>pvscan</code>. La principal diferència és que <code>pvdisplay</code> mostra la informació de tots els PVs, mentre que <code>pvscan</code> escaneja tots els dispositius per trobar PVs.</p>
</div>
</section>
<section id="inicialització-de-vgs" class="slide level2 smaller">
<h2>Inicialització de VGs</h2>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb14"><pre class="sourceCode numberSource bash number-lines code-with-copy"><code class="sourceCode bash"><span id="cb14-1"><a></a><span class="ex">vgcreate</span> VG PV <span class="pp">[</span><span class="ss">opcions</span><span class="pp">]</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<ul>
<li class="fragment"><strong>–clustered y/n</strong>: Activa o desactiva el VG per a l’ús en un clúster.</li>
<li class="fragment"><strong>–maxlogicalvolumes nombre</strong>: Número màxim de LVs que es poden crear en el VG.</li>
<li class="fragment"><strong>–maxphysicalvolumes nombre</strong>: Número màxim de PVs que es poden afegir al VG.</li>
<li class="fragment"><strong>–physicalextentsize mida[Unitat]</strong>: Mida dels PE.</li>
<li class="fragment"><strong>–metadatasize mida[Unitat]</strong>: Mida de les metadades.</li>
<li class="fragment"><strong>–alloc [contiguous|cling|normal|anywhere]</strong>: Estratègia d’assignació de PE.</li>
<li class="fragment"><strong>–longhelp</strong>: Mostra totes les opcions (semblant a <code>man vgcreate</code>).</li>
</ul>
<div class="fragment">
<p>Quan <em>un VG s’inicialitza a partir d’un PV, els valors de la mida de les metadades, començament dels PE,… es prenen del PV</em>, encara que s’hagin especificat opcions diferents amb <code>vgcreate</code>. ➡️ si voleu canviar-ho, <code>pvremove</code>. I després <code>vgcreate</code> amb les opcions desitjades.</p>
</div>
<aside class="notes">
<ul>
<li>vgcreate incialitza el PV en cas que no estigui inicialitzat.</li>
</ul>
<style type="text/css">
        span.MJX_Assistive_MathML {
          position:absolute!important;
          clip: rect(1px, 1px, 1px, 1px);
          padding: 1px 0 0 0!important;
          border: 0!important;
          height: 1px!important;
          width: 1px!important;
          overflow: hidden!important;
          display:block!important;
      }</style></aside>
</section>
<section id="augmentar-o-reduir-vgs-amb-vgextend-i-vgreduce" class="slide level2 smaller">
<h2>Augmentar o Reduir VGs amb <code>vgextend</code> i <code>vgreduce</code></h2>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb15"><pre class="sourceCode numberSource bash number-lines code-with-copy"><code class="sourceCode bash"><span id="cb15-1"><a></a><span class="ex">vgextend</span> VG PV <span class="pp">[</span><span class="ss">opcions</span><span class="pp">]</span> <span class="co"># Afegir un PV o una llista de PVs a un VG</span></span>
<span id="cb15-2"><a></a><span class="ex">vgreduce</span> VG PV <span class="pp">[</span><span class="ss">opcions</span><span class="pp">]</span> <span class="co"># Treure un PV o una llista de PVs d'un VG</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<ul>
<li class="fragment"><p><code>vgextend</code> permet afegir PVs no inicialitzats. En aquest cas, <code>vgextend</code> inicialitzarà els PVs amb les opcions especificades de <code>--labelsector</code>, <code>--metadatasize</code>, <code>--metadataignore</code>, <code>--pvmetadatacopies</code>, <code>--dataalignment</code>, <code>--dataalignmentoffset</code>.</p></li>
<li class="fragment"><p><code>vgreduce</code> detecta que un o més PVs estan perduts, necessita <code>vgreduce --removemissing</code> per fer que les metadades del VG siguin consistents de nou.</p></li>
</ul>
</section>
<section id="altres-operacions-amb-vgs" class="slide level2 smaller">
<h2>Altres operacions amb VGs</h2>
<ul>
<li class="fragment">Modificar les propietats d’un VG</li>
</ul>
<div class="fragment">
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb16"><pre class="sourceCode numberSource bash number-lines code-with-copy"><code class="sourceCode bash"><span id="cb16-1"><a></a><span class="ex">vgchange</span> <span class="pp">[</span><span class="ss">opcions</span><span class="pp">]</span> VG</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
<ul>
<li class="fragment">Eliminar un VG</li>
</ul>
<div class="fragment">
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb17"><pre class="sourceCode numberSource bash number-lines code-with-copy"><code class="sourceCode bash"><span id="cb17-1"><a></a><span class="ex">vgremove</span> VG</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
<ul>
<li class="fragment">Mostrar informació detallada d’un VG</li>
</ul>
<div class="fragment">
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb18"><pre class="sourceCode numberSource bash number-lines code-with-copy"><code class="sourceCode bash"><span id="cb18-1"><a></a><span class="ex">vgs</span></span>
<span id="cb18-2"><a></a><span class="ex">vgdisplay</span> VG</span>
<span id="cb18-3"><a></a><span class="ex">vgscan</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
<div class="center-container fragment">
<p>Totes aquestes comandes tenen opcions similars a les ja vistes per a <code>pvchange</code>, <code>pvremove</code>, <code>pvs</code>, <code>pvdisplay</code> i <code>pvscan</code>. Per a més informació, consulteu el manual de cada comanda.</p>
</div>
</section>
<section id="inicialització-de-lvs" class="slide level2 smaller">
<h2>Inicialització de LVs</h2>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb19"><pre class="sourceCode numberSource bash number-lines code-with-copy"><code class="sourceCode bash"><span id="cb19-1"><a></a><span class="ex">lvcreate</span> LV VG <span class="pp">[</span><span class="ss">opcions</span><span class="pp">]</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<ul>
<li class="fragment"><strong>-n|–name nom</strong>: Nom del LV.</li>
<li class="fragment"><strong>-L|–size mida[Unitat]</strong>: Mida del LV en unitats com MiB,GiB,TiB,….</li>
<li class="fragment"><strong>-l|–extents nombre</strong>: Defineix com un % del VG o bé com un nombre enter.</li>
<li class="fragment"><strong>-i|–stripes nombre</strong>: Defineix el nombre de stripes a utilitzar.</li>
<li class="fragment"><strong>-I|–stripesize mida[Unitat]</strong>: Defineix la mida de les stripes.</li>
<li class="fragment"><strong>-m|–mirrors nombre</strong>: Defineix el nombre de miralls a utilitzar.</li>
<li class="fragment"><strong>-s|–snapshot</strong>: Crea un snapshot del LV.</li>
<li class="fragment"><strong>-c|–chunksize mida[Unitat]</strong>: Defineix la mida dels chunks.</li>
<li class="fragment"><strong>-C|–contiguous y/n</strong>: Activa o desactiva l’assignació de PE contigus.</li>
<li class="fragment"><strong>-p|–permission r|rw</strong>: Defineix els permisos del LV.</li>
<li class="fragment"><strong>-t|–thinpool VG</strong>: Crea un thin pool LV.</li>
<li class="fragment"><strong>–longhelp</strong>: Mostra totes les opcions (semblant a <code>man lvcreate</code>).</li>
</ul>
</section>
<section id="consideracions-pràctiques-sobre-lvcreate-i" class="slide level2 smaller">
<h2>Consideracions pràctiques sobre <code>lvcreate</code> (I)</h2>
<ul>
<li class="fragment"><code>lvcreate</code> crea un nou LV en un VG. ➡️ Assigna extensions lògiques a les extensions físiques lliures del VG.</li>
</ul>
<div class="fragment center-container">
<p><strong>Què passaria si no hi ha prou espai lliure al VG?</strong> Hauríem d’ampliar el VG amb altres PVs (<code>vgextend</code>), o bé reduir o eliminar els LV existents (<code>lvremove</code>, <code>lvreduce</code>). Aquesta és una consideració important a tenir en compte quan es treballa amb grans volums de dades.</p>
</div>
<ul>
<li class="fragment"><p><code>lvcreate</code> permet especificar quins PVs utilitzarà un nou LV. ➡️ <code>lvcreate</code> assignarà extensió físiques només dels PVs especificats. Això pot ser útil quan es vol controlar l’assignació d’espai en un sistema amb múltiples PVs.</p></li>
<li class="fragment"><p><code>lvcreate</code> també pot crear LV RAID especificant un tipus de LV en crear el LV. ➡️ Diferents nivells de RAID requereixen diferents nombres de PVs únics en el VG per a l’assignació. Això pot ser útil per a la redundància de dades i la tolerància a fallades.</p></li>
</ul>
</section>
<section id="consideracions-pràctiques-sobre-lvcreate-ii" class="slide level2 smaller">
<h2>Consideracions pràctiques sobre <code>lvcreate</code> (II)</h2>
<ul>
<li class="fragment"><p><code>lvcreate</code> també pot crear thin pools i cache pools. ➡️ Aquests no són utilitzables com a dispositius de bloc estàndard, però els noms dels LV actuen com a referències. Aquests pools ens poden interesar en servidors on molts usuaris comparteixen recursos d’emmagatzematge i es volen limitar els recursos d’emmagatzematge per usuari.</p></li>
<li class="fragment"><p><code>lvcreate</code> també pot crear LV thin i LV VDO. ➡️ Aquests es creen amb una mida virtual en lloc d’una mida física. Permeten sobreprovisionament i compressió de dades. ➡️ Tots el usuaris tenen dret a més espai del que realment tenen.</p></li>
<li class="fragment"><p>Podeu utilitzar qualsevol <code>--size</code> o <code>--extents</code> per especificar la mida del LV.</p></li>
<li class="fragment"><p>En cas de no especificar un nom, es generarà un nom de LV amb el prefix <strong>lvol</strong> i un sufix numèric únic. Això pot ser útil quan es vol crear múltiples LVs de forma ràpida i eficient.</p></li>
</ul>
</section>
<section id="altres-operacions-amb-lvs" class="slide level2 smaller">
<h2>Altres operacions amb LVs</h2>
<p>Els LVs ens permeten les mateixes operacions amb opcions similars a les ja vistes per a PVs i VGs:</p>
<ul>
<li class="fragment">Mostrar informació detallada d’un LV: <code>lvs</code>, <code>lvdisplay</code>, <code>lvscan</code>.</li>
<li class="fragment">Modificar les propietats d’un LV: <code>lvchange</code>.</li>
<li class="fragment">Eliminar un LV: <code>lvremove</code>.</li>
<li class="fragment">Incrementar o disminuir la mida d’un LV: <code>lvextend</code>, <code>lvreduce</code>.</li>
</ul>
<div class="center-container fragment">
<p>Per a més informació, consulteu el manual de cada comanda o bé executeu <code>comanda --help</code>.</p>
</div>
</section></section>
<section>
<section id="casos-pràctics" class="title-slide slide level1 center">
<h1>Casos Pràctics</h1>

</section>
<section id="cas-pràctic-01-lvm-i-bootloaders" class="slide level2 smaller">
<h2>Cas Pràctic 01: LVM i BootLoaders</h2>
<p>Durant la realització d’una instal·lació d’un sistema operatiu, s’ha de decidir si utilitzar LVM per a la partició <code>/boot</code> o <code>/boot/efi</code>. Creus que és recomanable utilitzar LVM per a aquestes particions?</p>
<div class="fragment">
<p><strong>No</strong>, no és recomanable utilitzar LVM per a la partició <code>/boot</code> o <code>/boot/efi</code>. Els BootLoaders com GRUB no poden llegir els sistemes de fitxers LVM. Per tant, és millor utilitzar particions tradicionals per a <code>/boot</code> i <code>/boot/efi</code>.</p>
</div>
<div class="fragment">
<p>Durant el procés d’arrancada, el bootloader carrega el kernel i la imatge initramfs des de la partició <code>/boot</code>. Si aquesta partició està en un sistema de fitxers LVM, el bootloader no podrà llegir-la i no podrà carregar el sistema operatiu.</p>
</div>
</section>
<section id="cas-pràctic-02-dispositiu-compartit-usb" class="slide level2 smaller">
<h2>Cas Pràctic 02: Dispositiu compartit (USB)</h2>
<p>Assumeix que tens un <em>disc dur extern de 2TB</em> i vols fer-ho servir per guardar còpies de seguretat de dos usuaris. <em>El disc es connecta per usb físicament als dos dispositius</em>. <strong>L’usuari 1 necessita 1TB</strong> i <strong>l’usuari 2 necessita 500GB</strong>. Assumeix que <span class="alert">l’usuari 1 utilitza Windows</span> i <span class="alert">l’usuari 2 utilitza Linux</span>. Recomanaries utilitzar LVM per aquest cas d’ús?</p>
<div class="fragment">
<p><strong>No</strong>, LVM és una tecnologia específica de Linux i no és compatible amb Windows. Per tant, no és recomanable utilitzar LVM per aquest cas d’ús. En aquest cas, seria millor utilitzar particions tradicionals per a cada usuari. Podeu crear dues particions: una de 1TB formatada amb NTFS per a l’usuari 1 (Windows) i una altra de 500GB formatada amb ext4 per a l’usuari 2 (Linux). La resta de l’espai es podria deixar sense particionar o crear una partició compartida si es desitja.</p>
</div>
</section>
<section id="cas-pràctic-02-dispositiu-compartit-nas" class="slide level2 smaller">
<h2>Cas Pràctic 02: Dispositiu compartit (NAS)</h2>
<p>Assumeix ara que el <em>disc dur extern s’utilitza en un NAS</em> on <span class="alert">s’ofereix emmagatzematge compartit per a tots els usuaris en xarxa local</span>. En aquest cas, recomanaries utilitzar LVM per aquest cas d’ús?</p>
<div class="fragment">
<p><strong>Sí</strong>, en aquest cas, LVM pot ser una bona opció per a la gestió de l’espai d’emmagatzematge compartit. LVM permet crear volums lògics que es poden redimensionar en temps real. Cada usuari podria tenir el seu LV per emmagatzemar les seves dades. Com el NAS és un servidor de xarxa, els usuaris podrien accedir als seus LVs a través de la xarxa; independentment del sistema operatiu que utilitzin els usuaris en els seus dispositius.</p>
</div>
</section>
<section id="cas-pràctic-03-servidor-de-base-de-dades" class="slide level2 smaller">
<h2>Cas Pràctic 03: Servidor de Base de Dades</h2>
<p>Considerant que hem de configurar un <span class="alert">servidor de base de dades</span> amb <strong>4 discos durs de 1TB cadascun</strong>. Quins avantatges i desavantatges tindria la implementació de LVM en aquest context?</p>
<div class="fragment">
<p>LVM permet la creació de volums lògics que es poden distribuir en diversos discos físics, cosa que pot <em>millorar el rendiment mitjançant el striping</em>. ➡️ Aquesta configuració pot ser útil per a bases de dades que requereixen un alt rendiment d’E/S. Però, també augmenta <em>la complexitat i pot induir a overheads addicionals dels Volums Lògics</em>.</p>
</div>
<div class="fragment">
<p>A més, LVM admet instantànies, que poden ser útils per a les <em>còpies de seguretat i la recuperació de les dades</em>. Ara bé, si les instantànies es guarden en el mateix disc físic que la base de dades, i aquest disc falla, es perdran tant la base de dades com les instantànies.</p>
</div>
<div class="fragment">
<p>També permet <em>afegir o eliminar discos físics</em> <strong>sense temps d’inactivitat</strong>, cosa que <span class="alert">millora la disponibilitat</span> del servidor de base de dades. ➡️ Ens permet la seva ampliació en un futur sense haver de parar el servei.</p>
</div>
</section>
<section id="cas-pràctic-04-errors-i-fallades-i" class="slide level2 smaller">
<h2>Cas Pràctic 04: Errors i Fallades (I)</h2>
<p>Imagineu-vos que esteu treballant amb un grup de volums (<strong>VG1</strong>) que conté diversos discos físics, entre ells el <span class="alert">PV1</span>. A més, teniu un altre grup de volums (<strong>VG2</strong>) en un disc físic diferent (<em>PV2</em>) on guardeu les vostres instantànies. Què passaria amb les metadades de LVM i les instantànies si el disc físic <span class="alert">PV1</span> falla?</p>
<div class="fragment">
<p><strong>Si</strong> les metadades de LVM no estan en el disc fallat <span class="alert">PV1</span>, llavors els volums lògics que no estaven en el disc fallat segueixen estant disponibles. ➡️ En aquest cas, les metadades de LVM no es perden i es pot recuperar la informació dels volums lògics del <strong>VG1</strong>.</p>
</div>
<div class="fragment">
<p>No obstant això, si el disc fallat <span class="alert">PV1</span> contenia dades d’un volum lògic, aquestes dades es perdran a menys que tinguem una <strong>instantània</strong>. <em>A més, si el disc fallat contenia una part d’un volum lògic que s’estenia per diversos discos (com en el cas d’un volum lògic distribuït o striped), tot el volum lògic pot quedar inutilitzable</em>. ➡️ En aquest cas, les metadades de LVM es perden i no es pot recuperar la informació dels volums lògics del <strong>VG1</strong>.</p>
</div>
<div class="fragment center-container">
<p><strong>VG2</strong> conté les instantànies, per tant, si el disc físic <span class="alert">PV1</span> falla, les instantànies no es perdran. ➡️ Això permet restaurar les dades del volum lògic original del <strong>VG1</strong> a partir de les instantànies del <strong>VG2</strong>.</p>
</div>
</section>
<section id="cas-pràctic-05-escalabilitat-dapps-i" class="slide level2 smaller">
<h2>Cas Pràctic 05: Escalabilitat d’Apps (I)</h2>
<p>Una empresa està experimentant un ràpid creixement i necessita implementar un nou servidor per donar suport a una nova aplicació crítica per al negoci. El departament d’IT <strong>té pressupost limitat i només té disponible un emmagatzematge de 2TB per a aquest nou servidor</strong>. <span class="alert">L’aplicació requereix un mínim de 1TB d’emmagatzematge per funcionar correctament</span>, però es <em>preveu que el seu ús creixerà ràpidament en els propers mesos</em>.</p>
<div class="fragment">
<p>Com a administrador us plantejeu la possibilitat d’utilitzar el <strong>thin provisioning de LVM</strong> per donar suport a l’aplicació en creixement. Aquesta tècnica permet <strong>sobreprovisionar</strong> l’espai d’emmagatzematge, és a dir, assignar més espai del que realment teniu. Això és possible perquè el thin provisioning de LVM <span class="alert">només assigna l’espai d’emmagatzematge real a mesura que l’aplicació l’utilitza</span>.➡️ Si assigneu 4TB d’emmagatzematge a l’aplicació en un VG format pel disc de 2TB, inicialment només s’utilitzarà l’espai que l’aplicació necessita realment. Així, podreu planificar una ampliació del disc dur a 4TB en el futur sense haver de parar el servei.</p>
</div>
</section>
<section id="cas-pràctic-05-escalabilitat-dapps-ii" class="slide level2 smaller">
<h2>Cas Pràctic 05: Escalabilitat d’Apps (II)</h2>
<p>No obstant això, que pot passar si les vostres <em>previsions no són correctes i el creixement es mes rápid de l’esperat</em>. ➡️ L’aplicació intenta escriure més de 2TB de dades al disc.</p>
<div class="fragment">
<p>El <strong>thin provisioning</strong> de LVM no evitarà que l’aplicació s’aturi o es produeixin errors d’E/S quan l’aplicació excedeixi la capacitat real. ➡️ Quan l’aplicació intenti escriure més de 2TB de dades al disc, <span class="alert"><strong>es produirà un error d’E/S</strong></span>, ja que no hi haurà prou espai d’emmagatzematge disponible per emmagatzemar les dades.</p>
</div>
<div class="fragment center-container">
<p>En aquest cas, es necessitarà <span class="alert">afegir més espai d’emmagatzematge al grup de volums</span> i <strong>ampliar el volum lògic thin provisioned</strong> per donar suport a l’aplicació en creixement.</p>
</div>
</section>
<section id="cas-pràctic-05-escalabilitat-dapps-iii" class="slide level2 smaller">
<h2>Cas Pràctic 05: Escalabilitat d’Apps (III)</h2>
<p>En la situació anterior, heu decidit utilitzar el <strong>thin provisioning de LVM</strong> per donar suport a l’aplicació en creixement. Però, com a administrador de sistemes, us preocupa que l’aplicació pugui aturar-se o produir errors d’E/S si l’espai d’emmagatzematge s’omple ràpidament. <em>Què faríeu per reduir el risc d’aturades i errors d’E/S en aquest escenari?</em></p>
<div class="fragment">
<p>Una opció seria <strong>implementar un sistema de monitoreig i alertes</strong> que supervisi l’ús de l’espai d’emmagatzematge del grup de volums. Quan l’ús d’emmagatzematge superi un determinat llindar, el sistema generaria una alerta per <strong>afegir més espai d’emmagatzematge al grup de volums</strong> i <strong>ampliar el volum lògic thin provisioned</strong> per donar suport a l’aplicació en creixement.</p>
</div>
</section></section>
<section>
<section id="exercicis-i-laboratoris" class="title-slide slide level1 center">
<h1>Exercicis i Laboratoris</h1>

</section>
<section id="laboratoris" class="slide level2">
<h2>Laboratoris</h2>
<ul>
<li class="fragment">Laboratori 01: Instal·lació de LVM a AlmaLinux</li>
<li class="fragment">Laboratori 02: Gestió de LVM a AlmaLinux</li>
</ul>
</section>
<section id="laboratori-01-installació-de-lvm-a-almalinux" class="slide level2 smaller">
<h2>Laboratori 01: Instal·lació de LVM a AlmaLinux</h2>
<h4 id="requeriments">Requeriments</h4>
<ul>
<li class="fragment">Màquina virtual amb 1 disc dur de 20 GB, 1 GB de RAM i 1 CPU.</li>
<li class="fragment">Imatge ISO d’AlmaLinux.</li>
</ul>
<div class="fragment">
<h4 id="tasques">Tasques</h4>
<ul>
<li class="fragment">Instal·lar AlmaLinux i configurar LVM durant la instal·lació.</li>
<li class="fragment">Crearem un PV a partir del disc dur principal de 20GB.</li>
<li class="fragment">Crearem un VG anomenta almalinux.</li>
<li class="fragment"><code>/</code> serà un LV amb un sistema de fitxers xfs de 16,4 GB (almalinx-root).</li>
<li class="fragment"><code>/boot</code> i <code>boot/efi</code> seran particions tradicionals de 600MiB i 1024MiB respectivament.</li>
<li class="fragment"><code>swap</code> serà un LV de 2GB (almalinux-swap).</li>
</ul>
</div>
</section>
<section id="laboratori-01-selecció-de-dispositius" class="slide level2 smaller">
<h2>Laboratori 01: Selecció de dispositius</h2>

<img data-src="../figs/slides/03-lvm/exemple1/seleccio_dispositius.png" class="r-stretch"></section>
<section id="laboratori-01-configuració-lvm" class="slide level2 smaller">
<h2>Laboratori 01: Configuració LVM</h2>

<img data-src="../figs/slides/03-lvm/exemple1/particionatge.png" class="r-stretch"></section>
<section id="laboratori-01-configuració-de-les-particions" class="slide level2 smaller">
<h2>Laboratori 01: Configuració de les particions</h2>

<img data-src="../figs/slides/03-lvm/exemple1/lvm-config.png" class="r-stretch"></section>
<section id="laboratori-02-configuració-manual-lvm" class="slide level2 smaller">
<h2>Laboratori 02: Configuració manual LVM</h2>
<h4 id="requeriments-1">Requeriments</h4>
<ul>
<li class="fragment">Afegir un disc dur secundari de 10 GB a la màquina virtual.</li>
</ul>
<div class="fragment">
<h4 id="tasques-1">Tasques</h4>
<ul>
<li class="fragment">Crear un PV a partir del disc dur secundari.</li>
<li class="fragment">Crear un VG anomenat <code>datavg</code> a partir del PV.</li>
<li class="fragment">Crear un LV anomenat <code>home</code> amb un sistema de fitxers ext4 de 5GB.</li>
<li class="fragment">Muntarem el LV <code>home</code> a <code>/home</code>.</li>
<li class="fragment">Redimensionarem el LV en calent.</li>
</ul>
</div>
</section>
<section id="laboratori-02-creació-de-pvs-vgs-i-lvs" class="slide level2 smaller">
<h2>Laboratori 02: Creació de PVs, VGs i LVs</h2>
<ul>
<li class="fragment">Creació d’un PV amb el dispositiu <code>/dev/vdb</code>:</li>
</ul>
<div class="fragment">
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb20"><pre class="sourceCode numberSource bash number-lines code-with-copy"><code class="sourceCode bash"><span id="cb20-1"><a></a><span class="ex">pvcreate</span> /dev/vdb</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
<ul>
<li class="fragment">Creació d’un VG anomenat <code>datavg</code> amb el PV <code>/dev/vdb</code>:</li>
</ul>
<div class="fragment">
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb21"><pre class="sourceCode numberSource bash number-lines code-with-copy"><code class="sourceCode bash"><span id="cb21-1"><a></a><span class="ex">vgcreate</span> datavg /dev/vdb</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
<ul>
<li class="fragment">Creació d’un LV de 5GB anomenat <code>home</code> en el VG <code>datavg</code>:</li>
</ul>
<div class="fragment">
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb22"><pre class="sourceCode numberSource bash number-lines code-with-copy"><code class="sourceCode bash"><span id="cb22-1"><a></a><span class="ex">lvcreate</span> <span class="at">-L</span> 5GB M <span class="at">-n</span> home datavg</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
</section>
<section id="laboratori-02-creació-de-sistema-de-fitxers-i-muntatge" class="slide level2 smaller">
<h2>Laboratori 02: Creació de sistema de fitxers i muntatge</h2>
<ul>
<li class="fragment">Creació d’un sistema de fitxers ext4 en el LV <code>home</code>:</li>
</ul>
<div class="fragment">
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb23"><pre class="sourceCode numberSource bash number-lines code-with-copy"><code class="sourceCode bash"><span id="cb23-1"><a></a><span class="ex">mkfs.ext4</span> /dev/datavg/home</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
<ul>
<li class="fragment">Muntatge del LV <code>home</code> en el directori <code>/home</code>:</li>
</ul>
<div class="fragment">
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb24"><pre class="sourceCode numberSource bash number-lines code-with-copy"><code class="sourceCode bash"><span id="cb24-1"><a></a><span class="fu">mount</span> /dev/datavg/home /home</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
</section>
<section id="laboratori-02-ampliació-lvs" class="slide level2 smaller">
<h2>Laboratori 02: Ampliació LVs</h2>
<ul>
<li class="fragment">Ampliació del LV <code>home</code> a 7GB:</li>
</ul>
<div class="fragment">
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb25"><pre class="sourceCode numberSource bash number-lines code-with-copy"><code class="sourceCode bash"><span id="cb25-1"><a></a><span class="ex">lvextend</span> <span class="at">-L</span> 7GB /dev/datavg/home</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
<ul>
<li class="fragment">Redimensionar el sistema de fitxers ext4:</li>
</ul>
<div class="fragment">
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb26"><pre class="sourceCode numberSource bash number-lines code-with-copy"><code class="sourceCode bash"><span id="cb26-1"><a></a><span class="ex">resize2fs</span> /dev/datavg/home</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
</section>
<section id="laboratori-02-reducción-lvs" class="slide level2 smaller">
<h2>Laboratori 02: Reducción LVs</h2>
<ul>
<li class="fragment">Reducció del sistema de fitxers ext4:</li>
</ul>
<div class="fragment">
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb27"><pre class="sourceCode numberSource bash number-lines code-with-copy"><code class="sourceCode bash"><span id="cb27-1"><a></a><span class="ex">resize2fs</span> /dev/datavg/home 6G</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
<ul>
<li class="fragment">Reducció del LV <code>home</code> a 6GB:</li>
</ul>
<div class="fragment">
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb28"><pre class="sourceCode numberSource bash number-lines code-with-copy"><code class="sourceCode bash"><span id="cb28-1"><a></a><span class="ex">lvreduce</span> <span class="at">-L</span> 6GB /dev/datavg/home</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
</section>
<section id="exercicis" class="slide level2">
<h2>Exercicis</h2>
<ul>
<li class="fragment"><a href="../exercises/03-fs/10-ex-week7.html">Deplegament d’un servidor web amb LVM</a></li>
</ul>
</section>
<section id="thats-all" class="slide level2">
<h2>That’s all</h2>
<div class="columns">
<div class="column" style="width:45%;">
<div title="Take Home Message">
<div class="callout callout-note callout-titled callout-style-default">
<div class="callout-body">
<div class="callout-title">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<p><strong>Take Home Message</strong></p>
</div>
<div class="callout-content">
<ul>
<li class="fragment">LVM és una eina potent que <strong>simplifica</strong> la <strong>gestió de l’espai d’emmagatzematge</strong> en sistemes Linux.</li>
<li class="fragment">Ofereix als administradors de sistemes la <strong>flexibilitat</strong> de crear, modificar i eliminar particions de manera <strong>dinàmica</strong> sense necessitat d’aturar el sistema.</li>
</ul>
</div>
</div>
</div>
</div>
</div><div class="column" style="width:5%;">

</div><div class="column" style="width:50%;">
<p><img data-src="https://static.posters.cz/image/750/posters/looney-tunes-thats-all-folks-i295.jpg" style="width:70.0%"></p>
</div></div>


</section></section>
    </div>
  <div class="quarto-auto-generated-content" style="display: none;">
<p><img src="../figs/corporative/institute.png" class="slide-logo"></p>
<div class="footer footer-default">
<p>Unitat 3 · Administració i Manteniment de Sistemes i Aplicacions (AMSA) <a href="../index.html">🏠</a></p>
</div>
</div></div>

  <script>window.backupDefine = window.define; window.define = undefined;</script>
  <script src="../site_libs/revealjs/dist/reveal.js"></script>
  <!-- reveal.js plugins -->
  <script src="../site_libs/revealjs/plugin/quarto-line-highlight/line-highlight.js"></script>
  <script src="../site_libs/revealjs/plugin/pdf-export/pdfexport.js"></script>
  <script src="../site_libs/revealjs/plugin/reveal-menu/menu.js"></script>
  <script src="../site_libs/revealjs/plugin/reveal-menu/quarto-menu.js"></script>
  <script src="../site_libs/revealjs/plugin/quarto-support/support.js"></script>
  

  <script src="../site_libs/revealjs/plugin/notes/notes.js"></script>
  <script src="../site_libs/revealjs/plugin/search/search.js"></script>
  <script src="../site_libs/revealjs/plugin/zoom/zoom.js"></script>
  <script src="../site_libs/revealjs/plugin/math/math.js"></script>
  <script>window.define = window.backupDefine; window.backupDefine = undefined;</script>

  <script>

      // Full list of configuration options available at:
      // https://revealjs.com/config/
      Reveal.initialize({
'controlsAuto': true,
'previewLinksAuto': false,
'pdfSeparateFragments': false,
'autoAnimateEasing': "ease",
'autoAnimateDuration': 1,
'autoAnimateUnmatched': true,
'jumpToSlide': true,
'menu': {"side":"left","useTextContentForMissingTitles":true,"markers":false,"loadIcons":false,"custom":[{"title":"Tools","icon":"<i class=\"fas fa-gear\"></i>","content":"<ul class=\"slide-menu-items\">\n<li class=\"slide-tool-item active\" data-item=\"0\"><a href=\"#\" onclick=\"RevealMenuToolHandlers.fullscreen(event)\"><kbd>f</kbd> Fullscreen</a></li>\n<li class=\"slide-tool-item\" data-item=\"1\"><a href=\"#\" onclick=\"RevealMenuToolHandlers.speakerMode(event)\"><kbd>s</kbd> Speaker View</a></li>\n<li class=\"slide-tool-item\" data-item=\"2\"><a href=\"#\" onclick=\"RevealMenuToolHandlers.overview(event)\"><kbd>o</kbd> Slide Overview</a></li>\n<li class=\"slide-tool-item\" data-item=\"3\"><a href=\"#\" onclick=\"RevealMenuToolHandlers.togglePdfExport(event)\"><kbd>e</kbd> PDF Export Mode</a></li>\n<li class=\"slide-tool-item\" data-item=\"4\"><a href=\"#\" onclick=\"RevealMenuToolHandlers.toggleScrollView(event)\"><kbd>r</kbd> Scroll View Mode</a></li>\n<li class=\"slide-tool-item\" data-item=\"5\"><a href=\"#\" onclick=\"RevealMenuToolHandlers.keyboardHelp(event)\"><kbd>?</kbd> Keyboard Help</a></li>\n</ul>"}],"openButton":true},
'smaller': false,
 
        // Display controls in the bottom right corner
        controls: false,

        // Help the user learn the controls by providing hints, for example by
        // bouncing the down arrow when they first encounter a vertical slide
        controlsTutorial: false,

        // Determines where controls appear, "edges" or "bottom-right"
        controlsLayout: 'edges',

        // Visibility rule for backwards navigation arrows; "faded", "hidden"
        // or "visible"
        controlsBackArrows: 'faded',

        // Display a presentation progress bar
        progress: true,

        // Display the page number of the current slide
        slideNumber: 'c/t',

        // 'all', 'print', or 'speaker'
        showSlideNumber: 'all',

        // Add the current slide number to the URL hash so that reloading the
        // page/copying the URL will return you to the same slide
        hash: true,

        // Start with 1 for the hash rather than 0
        hashOneBasedIndex: false,

        // Flags if we should monitor the hash and change slides accordingly
        respondToHashChanges: true,

        // Push each slide change to the browser history
        history: true,

        // Enable keyboard shortcuts for navigation
        keyboard: true,

        // Enable the slide overview mode
        overview: true,

        // Disables the default reveal.js slide layout (scaling and centering)
        // so that you can use custom CSS layout
        disableLayout: false,

        // Vertical centering of slides
        center: false,

        // Enables touch navigation on devices with touch input
        touch: true,

        // Loop the presentation
        loop: false,

        // Change the presentation direction to be RTL
        rtl: false,

        // see https://revealjs.com/vertical-slides/#navigation-mode
        navigationMode: 'linear',

        // Randomizes the order of slides each time the presentation loads
        shuffle: false,

        // Turns fragments on and off globally
        fragments: true,

        // Flags whether to include the current fragment in the URL,
        // so that reloading brings you to the same fragment position
        fragmentInURL: false,

        // Flags if the presentation is running in an embedded mode,
        // i.e. contained within a limited portion of the screen
        embedded: false,

        // Flags if we should show a help overlay when the questionmark
        // key is pressed
        help: true,

        // Flags if it should be possible to pause the presentation (blackout)
        pause: true,

        // Flags if speaker notes should be visible to all viewers
        showNotes: false,

        // Global override for autoplaying embedded media (null/true/false)
        autoPlayMedia: null,

        // Global override for preloading lazy-loaded iframes (null/true/false)
        preloadIframes: null,

        // Number of milliseconds between automatically proceeding to the
        // next slide, disabled when set to 0, this value can be overwritten
        // by using a data-autoslide attribute on your slides
        autoSlide: 0,

        // Stop auto-sliding after user input
        autoSlideStoppable: true,

        // Use this method for navigation when auto-sliding
        autoSlideMethod: null,

        // Specify the average time in seconds that you think you will spend
        // presenting each slide. This is used to show a pacing timer in the
        // speaker view
        defaultTiming: null,

        // Enable slide navigation via mouse wheel
        mouseWheel: false,

        // The display mode that will be used to show slides
        display: 'block',

        // Hide cursor if inactive
        hideInactiveCursor: true,

        // Time before the cursor is hidden (in ms)
        hideCursorTime: 5000,

        // Opens links in an iframe preview overlay
        previewLinks: false,

        // Transition style (none/fade/slide/convex/concave/zoom)
        transition: 'fade',

        // Transition speed (default/fast/slow)
        transitionSpeed: 'default',

        // Transition style for full page slide backgrounds
        // (none/fade/slide/convex/concave/zoom)
        backgroundTransition: 'none',

        // Number of slides away from the current that are visible
        viewDistance: 3,

        // Number of slides away from the current that are visible on mobile
        // devices. It is advisable to set this to a lower number than
        // viewDistance in order to save resources.
        mobileViewDistance: 2,

        // The "normal" size of the presentation, aspect ratio will be preserved
        // when the presentation is scaled to fit different resolutions. Can be
        // specified using percentage units.
        width: 1050,

        height: 700,

        // Factor of the display size that should remain empty around the content
        margin: 0.1,

        math: {
          mathjax: 'https://cdn.jsdelivr.net/npm/mathjax@2.7.9/MathJax.js',
          config: 'TeX-AMS_HTML-full',
          tex2jax: {
            inlineMath: [['\\(','\\)']],
            displayMath: [['\\[','\\]']],
            balanceBraces: true,
            processEscapes: false,
            processRefs: true,
            processEnvironments: true,
            preview: 'TeX',
            skipTags: ['script','noscript','style','textarea','pre','code'],
            ignoreClass: 'tex2jax_ignore',
            processClass: 'tex2jax_process'
          },
        },

        // reveal.js plugins
        plugins: [QuartoLineHighlight, PdfExport, RevealMenu, QuartoSupport,

          RevealMath,
          RevealNotes,
          RevealSearch,
          RevealZoom
        ]
      });
    </script>
    <script id="quarto-html-after-body" type="application/javascript">
      window.document.addEventListener("DOMContentLoaded", function (event) {
        const tabsets =  window.document.querySelectorAll(".panel-tabset-tabby")
        tabsets.forEach(function(tabset) {
          const tabby = new Tabby('#' + tabset.id);
        });
        const isCodeAnnotation = (el) => {
          for (const clz of el.classList) {
            if (clz.startsWith('code-annotation-')) {                     
              return true;
            }
          }
          return false;
        }
        const onCopySuccess = function(e) {
          // button target
          const button = e.trigger;
          // don't keep focus
          button.blur();
          // flash "checked"
          button.classList.add('code-copy-button-checked');
          var currentTitle = button.getAttribute("title");
          button.setAttribute("title", "Copied!");
          let tooltip;
          if (window.bootstrap) {
            button.setAttribute("data-bs-toggle", "tooltip");
            button.setAttribute("data-bs-placement", "left");
            button.setAttribute("data-bs-title", "Copied!");
            tooltip = new bootstrap.Tooltip(button, 
              { trigger: "manual", 
                customClass: "code-copy-button-tooltip",
                offset: [0, -8]});
            tooltip.show();    
          }
          setTimeout(function() {
            if (tooltip) {
              tooltip.hide();
              button.removeAttribute("data-bs-title");
              button.removeAttribute("data-bs-toggle");
              button.removeAttribute("data-bs-placement");
            }
            button.setAttribute("title", currentTitle);
            button.classList.remove('code-copy-button-checked');
          }, 1000);
          // clear code selection
          e.clearSelection();
        }
        const getTextToCopy = function(trigger) {
          const outerScaffold = trigger.parentElement.cloneNode(true);
          const codeEl = outerScaffold.querySelector('code');
          for (const childEl of codeEl.children) {
            if (isCodeAnnotation(childEl)) {
              childEl.remove();
            }
          }
          return codeEl.innerText;
        }
        const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
          text: getTextToCopy
        });
        clipboard.on('success', onCopySuccess);
        if (window.document.getElementById('quarto-embedded-source-code-modal')) {
          const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
            text: getTextToCopy,
            container: window.document.getElementById('quarto-embedded-source-code-modal')
          });
          clipboardModal.on('success', onCopySuccess);
        }
          var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
          var mailtoRegex = new RegExp(/^mailto:/);
            var filterRegex = new RegExp("https:\/\/amsa-gei-udl-2526-105013\.github\.io\/course\/");
          var isInternal = (href) => {
              return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
          }
          // Inspect non-navigation links and adorn them if external
         var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
          for (var i=0; i<links.length; i++) {
            const link = links[i];
            if (!isInternal(link.href)) {
              // undo the damage that might have been done by quarto-nav.js in the case of
              // links that we want to consider external
              if (link.dataset.originalHref !== undefined) {
                link.href = link.dataset.originalHref;
              }
            }
          }
        function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
          const config = {
            allowHTML: true,
            maxWidth: 500,
            delay: 100,
            arrow: false,
            appendTo: function(el) {
                return el.closest('section.slide') || el.parentElement;
            },
            interactive: true,
            interactiveBorder: 10,
            theme: 'light-border',
            placement: 'bottom-start',
          };
          if (contentFn) {
            config.content = contentFn;
          }
          if (onTriggerFn) {
            config.onTrigger = onTriggerFn;
          }
          if (onUntriggerFn) {
            config.onUntrigger = onUntriggerFn;
          }
            config['offset'] = [0,0];
            config['maxWidth'] = 700;
          window.tippy(el, config); 
        }
        const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
        for (var i=0; i<noterefs.length; i++) {
          const ref = noterefs[i];
          tippyHover(ref, function() {
            // use id or data attribute instead here
            let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
            try { href = new URL(href).hash; } catch {}
            const id = href.replace(/^#\/?/, "");
            const note = window.document.getElementById(id);
            if (note) {
              return note.innerHTML;
            } else {
              return "";
            }
          });
        }
        const findCites = (el) => {
          const parentEl = el.parentElement;
          if (parentEl) {
            const cites = parentEl.dataset.cites;
            if (cites) {
              return {
                el,
                cites: cites.split(' ')
              };
            } else {
              return findCites(el.parentElement)
            }
          } else {
            return undefined;
          }
        };
        var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
        for (var i=0; i<bibliorefs.length; i++) {
          const ref = bibliorefs[i];
          const citeInfo = findCites(ref);
          if (citeInfo) {
            tippyHover(citeInfo.el, function() {
              var popup = window.document.createElement('div');
              citeInfo.cites.forEach(function(cite) {
                var citeDiv = window.document.createElement('div');
                citeDiv.classList.add('hanging-indent');
                citeDiv.classList.add('csl-entry');
                var biblioDiv = window.document.getElementById('ref-' + cite);
                if (biblioDiv) {
                  citeDiv.innerHTML = biblioDiv.innerHTML;
                }
                popup.appendChild(citeDiv);
              });
              return popup.innerHTML;
            });
          }
        }
      });
      </script>
    

</body></html>